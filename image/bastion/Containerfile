# For some IDEs, remote SSH plugin does not support alpine
FROM fedora:37

RUN dnf install -y \
    openssh-server \
    # newer nsenter
    util-linux \
    # useful tools
    rsync curl bash socat \
    # client is useful for debugging & rsync
    openssh \
    && dnf clean all

ARG USER=dev
ARG UID=30001

RUN echo "Adding user: ${USER} (${UID})"; \
    adduser --uid ${UID} --shell /bin/sh ${USER} && \
    sed -i "s/${USER}:!/${USER}:*/g" /etc/shadow && \
    # unlock also root, needed for gate
    sed -i "s/root:!/root:*/g" /etc/shadow

# no need for motto of the day
RUN rm /etc/motd

# keeping original /etc/ssh/sshd_config for documentation
COPY --chmod=644 sshd_config /etc/ssh/sshd_config_template
COPY entrypoint.sh /

USER dev
EXPOSE 2222/tcp

ENTRYPOINT [ "/entrypoint.sh" ]
